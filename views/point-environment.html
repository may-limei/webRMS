<!DOCTYPE HTML>
<!--
	Helios by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>辐射防护在线监测系统 | <%=title %></title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/bootstrap3-3-7.min.css">
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->

		<script>
			//var windowHeight=screen.availHeight;
		</script>

		<!--socket & epics-->
		<script src="socket.io/socket.io.js"></script>
		<script src="bower_components/async/dist/async.js"></script>
		
		<!--echarts-->
		<script type="text/javascript" src="./assets/js/esl2.js"></script>
		<script src="assets/js/bootstrap3-3-7.min.js"></script>

		<script>
			//socket & EPICS
			//定义变量
			var serverIP="127.0.0.1";
			var socket = io.connect(serverIP+':3031');

			var testio=0;
			var env1=0;

			var pvs={
				ai:[
					{pvname:"EVMN-GDRM:DoseRate001"},
					{pvname:"EVMN-GDRM:DoseRate002"},
					{pvname:"EVMN-GDRM:DoseRate003"},
					{pvname:"EVMN-GDRM:DoseRate004"},
					{pvname:"EVMN-GDRM:DoseRate005"},
					{pvname:"ARMS-GDRM:GDoseRate001"}
				],
				ao:[
					{pvname:"mayHost:ao1"}, 
					{pvname:"mayHost:ao2"}, 
					{pvname:"mayHost:ao3"}
				]
			};
			var datapvi = new Array();	var ilen = datapvi.length;	var ii = 0;
			var datapvo = new Array();	var olen = datapvo.length;	var oo = 0;

		</script>
		
	</head>

	<body class="right-sidebar">	
		<div id="page-wrapper">

			<!-- Header -->
				<div id="header">
					<!-- Nav -->
						<nav id="nav">
							<ul>
								<li><a href="index.html">首页</a></li>
								<li>
									<a href=""><strong>监测点</strong></a>
									<ul>
										<li><a href="point-environment.html"><strong>环境</strong></a></li>
										<li><a href="point-103.html">103楼（放化）</a></li>
										<li><a href="point-104.html">104楼（三废处理）</a></li>
										<li><a href="point-106.html">106楼（废物暂存）</a></li>
										<li><a href="point-109.html">109楼（中子物理）</a></li>
										<li><a href="point-112.html">112楼（电子辐照）</a></li>
										<li><a href="point-115.html">115楼（加速器）</a></li>
									</ul>
								</li>
								<li>
									<a href="left-sidebar.html">仪器状态</a>
									<ul>
										<li><a href="#">PRMS（工艺Gamma监测仪）</a></li>
										<li><a href="#">ERMS（环境Gamma监测仪）</a></li>
										<li><a href="#">AGMS（区域Gamma监测仪）</a></li>
										<li><a href="#">ANMS（区域中子射监测仪）</a></li>
										<li><a href="#">GEMS（放射性气溶胶监测仪）</a></li>
										<li><a href="#">LEMS（放射性废液监测仪）</a></li>
									</ul>
								</li>
								<li><a href="right-sidebar.html">监测日志</a></li>
								<li><a href="no-sidebar.html">关于</a></li>
							</ul>
						</nav>

				</div>

			<!-- 地图map -->
			<div class="row">
				<div class="9u 12u(mobile)" id="content">
					<div id="realtimeLine" style="height:700px; width:100%;" class="12u"></div>
				</div>
				<div class="3u 12u(mobile)" id="content">
					<div id="" style="height:700px; width:100%;" class="12u"></div>
				</div>
			</div>
			<!-- 地图map -->
			<div class="wrapper style1">
				<div id="sinapsvg" style="height:700px; width:100%;" class="12u"></div>
			</div>
	
			<!-- Footer -->
            <div id="footer">
				<div class="container">
					<div class="row">
						<!-- 监测仪 -->
						<section class="4u 12u(mobile)">
							<header>
								<h2 class="icon fa-instagram circled"><span class="label">仪器状态</span></h2><!-- 图标的内容 -->
							</header>
							<ul class="divided">
								<li>
									<br>
									<article class="tweet">
										<h4 style="text-align: center"><a href="#">PRMS - 工艺Gamma监测仪</a></h4>
									</article>
								</li>
								<li>
									<article class="tweet">
										<h4 style="text-align: center"><a href="#">ERMS - 环境Gamma监测仪</a></h4>
									</article>
								</li>
								<li>
									<article class="tweet">
										<h4 style="text-align: center"><a href="#">AGMS - 区域Gamma监测仪</a></h4>
									</article>
								</li>
								<li>
									<article class="tweet">
										<h4 style="text-align: center"><a href="#">ANMS - 区域中子射监测仪</a></h4>
									</article>
								</li>
								<li>
									<article class="tweet">
										<h4 style="text-align: center"><a href="#">GEMS - 放射性气溶胶监测仪</a></h4>
									</article>
								</li>
								<li>
									<article class="tweet">
										<h4 style="text-align: center"><a href="#">LEMS - 放射性废液监测仪</a></h4>
									</article>
								</li>
							</ul>
						</section>

						<!-- Posts -->
						<section class="4u 12u(mobile)">
							<header>
								<h2 class="icon fa-file circled"><span class="label">监测点</span></h2>
							</header>
							<ul class="divided">
								<li>
									<article class="post stub">
										<header>
											<h4><a href="#">环境监测</a></h4>
										</header>
									</article>
								</li>
								<li>
									<article class="post stub">
										<header>
											<h4><a href="#">103楼-放化实验室</a></h4>
										</header>
									</article>
								</li>
								<li>
									<article class="post stub">
										<header>
											<h4><a href="#">104楼-放射性三废处理设施</a></h4>
										</header>
									</article>
								</li>
								<li>
									<article class="post stub">
										<header>
											<h4><a href="#">106-放射性废物暂存库</a></h4>
										</header>
									</article>
								</li>
								<li>
									<article class="post stub">
										<header>
											<h4><a href="#">109楼-中子物理实验装置</a></h4>
										</header>
									</article>
								</li>
								<li>
									<article class="post stub">
										<header>
											<h4><a href="#">112楼-电子辐照实验装置</a></h4>
										</header>
									</article>
								</li>
								<li>
									<article class="post stub">
										<header>
											<h4><a href="#">115楼-电子直线加速器</a></h4>
										</header>
									</article>
								</li>
							</ul>
						</section>

						<!-- Photos -->
						<section class="4u 12u(mobile)">
							<header>
								<h2 class="icon fa-camera circled"><span class="label">Photos</span></h2>
							</header>
							<div class="row 25% no-collapse">
								<div class="6u">
									<a href="#" class="image fit"><img src="images/pic10.jpg" alt="" /></a>
								</div>
								<div class="6u">
									<a href="#" class="image fit"><img src="images/pic11.jpg" alt="" /></a>
								</div>
							</div>
							<div class="row 25% no-collapse">
								<div class="6u">
									<a href="#" class="image fit"><img src="images/pic12.jpg" alt="" /></a>
								</div>
								<div class="6u">
									<a href="#" class="image fit"><img src="images/pic13.jpg" alt="" /></a>
								</div>
							</div>
							<div class="row 25% no-collapse">
								<div class="6u">
									<a href="#" class="image fit"><img src="images/pic14.jpg" alt="" /></a>
								</div>
								<div class="6u">
									<a href="#" class="image fit"><img src="images/pic15.jpg" alt="" /></a>
								</div>
							</div>
						</section>
					</div>
					<hr />
					<div class="row">
						<div class="12u">
							<!-- Contact -->
							<section class="contact">
								<header>
									<h3>联系我们</h3>
								</header>
								<p>地址： 上海市嘉定区嘉罗公路2019号（201800）</p>
								<p>邮箱： email@sinap.ac.cn</p>
								<p>电话： 021 - 12345678</p>
							</section>

							<!-- Copyright -->
							<div class="copyright">
								<ul class="menu">
									<li>&copy; <a href="http://www.sinap.cas.cn/">中国科学院上海应用物理研究所</a></li><li>钍基熔盐堆先进核能系统</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>




	<!-- start of line -->
	<script type="text/javascript">
		// 路径配置
		require.config({
			paths: {
				'echarts': 'assets/js/echarts/echarts',
				'echarts/chart/line': 'assets/js/echarts/chart/line',
				'echarts/chart/bar': 'assets/js/echarts/chart/bar',
				'echarts/chart/map': 'assets/js/echarts/chart/map',
				'echarts/chart/gauge': 'assets/js/echarts/chart/gauge'
			}
		});


		var dataLine=[4, 8, 15, 13, 12, 6, 10, 1, 1, 1, 1, 1, 1, 1];		

		require([
			'echarts',
			'echarts/chart/line',
			'echarts/chart/gauge',
		], function (echarts) {//start of function(echarts)

			var chartLine = echarts.init(document.getElementById('realtimeLine'), null, {});

			var optionLine = {//start of optionLine
				//backgroundColor: '#303030',
				title : {
					text: '环境监测Gamma剂量率报表',
					//subtext: '环境监测',
					left:'1%',
					top:'6%'
				},
				tooltip : {
					trigger: 'axis'
				},
				legend: {
					data:['环境监测1','环境监测2','环境监测3','环境监测4','环境监测5']
				},
				grid:{
					x2: '30%',
				},
				toolbox: {
					show : true,
					feature : {
						dataView : {show: true, readOnly: false},
						restore : {show: true},
						saveAsImage : {show: true}
					}
				},
				calculable : true,
				xAxis : {
					type : 'category',
					boundaryGap : false,
					data : (function (){
						var now = new Date();
						var res = [];
						var len = 15;
						while (len--) {
							res.unshift(now.toLocaleTimeString().replace(/^\D*/,''));
							now = new Date(now - 2000);
						}
						return res;
					})()
				},
				yAxis : [
				{
					type : 'value',
					axisLabel : {
						formatter: '{value} mGy/h'
					}
				}
				],
				series : [
				{
					name:'环境监测1',
					type:'line',
					data:dataLine,
					markPoint : {
						data : [
							{type : 'max', name: '最大值'},
							{type : 'min', name: '最小值'}
						]
					},
					markLine : {
						data : [
							{type : 'average', name: '平均值'}
						]
					}
				},
				{
					name:'环境1',
					type:'gauge',
					center:['83%','33%'],
					radius:['25%','30%'],
					min:0,
					max:100,
					splitNumber:10,
					axisLine: {            // 坐标轴线
						shadowColor:'#999',//透明
						shadowBlur:5,
						lineStyle: {       // 属性lineStyle控制线条样式
							color: [[0.2, '#228b22'],[0.8, '#48b'],[1, '#ff4500']], 
							width: 6
						}
					},
					axisTick: {            // 坐标轴小标记
						splitNumber: 10,   // 每份split细分多少段
						length :10,        // 属性length控制线长
						shadowColor:'#999',//透明
						shadowBlur:5,
						lineStyle: {       // 属性lineStyle控制线条样式
							color: 'auto'
						}
					},
					axisLabel: {           // 坐标轴文本标签，详见axis.axisLabel
						shadowColor:'#999',//透明
						shadowBlur:5,
						textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
							color: 'auto',
							fontSize:14
						}
					},
					splitLine: {           // 分隔线
						show: true,        // 默认显示，属性show控制显示与否
						length :15,         // 属性length控制线长
						shadowColor:'#999',//透明
						shadowBlur:5,
						lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
							color: 'auto'
						}
					},
					pointer : {
						width : 5,
						shadowColor:'#999',//透明
						shadowBlur:5,
					},
					title : {
						show : true,
						offsetCenter: [0, '-37%'],       // x, y，单位px
						textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
							fontWeight: 'bold',
							fontSize:18
						}
					},
					detail : {
						formatter:'{value}',
						height:40,
						width:90,
						backgroundColor:'rgba(10,10,10,1)',
						offsetCenter: [-3,'40%'],
						textStyle: {       // 其余属性默认使用全局文本样式，详见TEXTSTYLE
							color: 'auto',
							fontWeight: 'bolder',
							fontSize: 28
						},
						shadowColor:'#999',//透明
						shadowBlur:5,
					},
					data:[{value: (Math.random()*100).toFixed(2)-0, name: 'nGy/h'}]
				}
				]
			};

			//遍历pvs.ai的各个元素。async保证每个pvs.ai.name事件都能执行回调函数的操作，而不是最后一个才执行
			async.map(pvs.ai,function(item,callback){//map是遍历函数
	  			socket.on(item.pvname, function (data) {
testio = data;
				// if(document.getElementById(item.pvname)){
		 		// 	document.getElementById(item.pvname).innerHTML=data;
				// }
				datapvi[ii]=data;
				// chartLine.clear();
				// chartLine.setOption(optionLine,true); 
		    	});
				if(ii<ilen){ii += 1;}else{ii = 0;}
   			}, function(err,results){
	 			callback(err,results); 
   			});

			// chartLine.clear();
			// chartLine.setOption(optionLine,true);  

			var timeTicketLine=function(){};
			clearInterval(timeTicketLine);
			timeTicketLine= setInterval(function(){
				dataLine.shift();
				env1=(Math.random()*100).toFixed(2)-0;
				dataLine.push(env1);
				optionLine.series[0].data=dataLine;
				optionLine.series[1].data=[{value:env1, name: 'nGy/h'}];
				//optionLine.xAxis=(new Date()).toLocaleTimeString().replace(/^\D*/,'');
				//chartLine.clear();
				chartLine.setOption(optionLine,true);
			},2000)

			dataLine.shift();
			dataLine.push(100);
			dataLine.shift();
			dataLine.push(67);
		
					//var timeTicketLine = function () {};
					// clearInterval(timeTicketLine);
					// timeTicketLine = setInterval(function (){
					// 	nowrv0=(Math.random()*100).toFixed(2)-0;
					// 	dataLine.shift();
					// 	dataLine.push(nowrv0);
					// 	chartLine.setOption({
					// 		series: [
					// 			{
					// 				  data: [{value:nowrv0, name: 'mGy/h'}] 
					// 			},
					// 			{
					// 				data: dataLine
					// 			}
					// 		]
					// 	});
					// 	chartLine.setOption(optionLine,true);
					// },2000)
		
		},//end of function (echarts)
	);
					
	</script><!-- end of line -->


	<!-- start of sinapsvg -->
	<script type="text/javascript">	
		// 使用模块
		require(
			[
				'echarts',
				'echarts/chart/bar' ,// 使用柱状图就加载bar模块，按需加载
				'echarts/chart/map'
			],

		function (ec) {
			/***-- 自定义svg地图（名称取为sinap） --***/
			require('echarts/util/mapData/params').params.sinap = {
				getGeoJson: function (callback) {
					$.ajax({
						url: "images/sinap2.svg",
						dataType: 'xml',
						success: function (xml) {
							callback(xml)
						}
					});
				}
			}
			
			// 基于准备好的dom，初始化echarts图表
			var chart_sinapsvg = ec.init(document.getElementById('sinapsvg')); 
				
			//start option_sinapsvg
			var option_sinapsvg = {
				backgroundColor: '#fefefe',
				color:[
					'lime',
					'#65c9ff'
				],
				tooltip: {
					trigger: 'item',
					formatter: function (v) {
						return v[1]+'<br/>测量值为：'+v[2];
					}
				},
				toolbox: {
					show: true,
					feature: {
						dataView: { show: true, readOnly: true },
						restore: { show: true },
						saveAsImage: { show: true }
					}
				},
				legend: {
					orient: 'vertical',
					y: 'bottom',
					x:'right',
					data:['γ环境监测站','其他监测站'],
				},
				series : [
				{
					name:'γ环境监测站',
				    type: 'map',
				    mapType: 'sinap',
				    mapLabelColor: "#ffffff",
				    roam:false,
				    itemStyle:{
						normal:{
							borderColor:'rgba(100,149,237)',
							borderWidth:0.5,
							areaColor: 'lime',
							borderColor: '#111',
							areaStyle:{
								color: '#000000'
					  		}
						},
						emphasis: {
							areaColor: '#2a333d'
						}
					},
					data:[
						{name: 'γ环境监测站1', value: Math.round(testio*1000), geoCoord:[805.126, 786.913]},
						{name: 'γ环境监测站2', value: Math.round(testio*1000), geoCoord:[535.126, 496.913]},
						{name: 'γ环境监测站3', value: Math.round(testio*1000), geoCoord:[250.126, 810.913]},
						{name: 'γ环境监测站4', value: 400, geoCoord:[960.126, 126.913]},
							{name: 'γ环境监测站5', value: 500, geoCoord:[225.226, 266.913]}
					],  
					markPoint : {
						symbol:'circle',
						symbolSize : 20,
						effect : {
							show: true,
							color: 'lime',
								shadowBlur : 10
						},
						data : [
							{name: 'γ环境监测站1', value: Math.round(testio*1000), geoCoord:[805.126, 786.913], itemStyle:{normal:{color:'lime'}}},
							{name: 'γ环境监测站2', value: Math.round(testio*1000), geoCoord:[535.126, 496.913], itemStyle:{normal:{color:'lime'}}},
							{name: 'γ环境监测站3', value: Math.round(testio*1000), geoCoord:[250.126, 810.913], itemStyle:{normal:{color:'lime'}}},
							{name: 'γ环境监测站4', value: 400, geoCoord:[960.126, 126.913], itemStyle:{normal:{color:'lime'}}},
							{name: 'γ环境监测站5', value: 500, geoCoord:[225.226, 266.913], itemStyle:{normal:{color:'lime'}}}
						]
					},					  
				},
				{
					name:'其他监测站',
				    type: 'map',
				    mapType: 'sinap',
				    mapLabelColor: "#ffffff",
				    roam:true,
				    scaleLimit:{
					    max: 1.5,
					    min:0.5
				    },
				    itemStyle:{
						normal:{
							borderColor:'rgba(100,149,237)',
							borderWidth:0.5,
							areaColor: 'lime',
							borderColor: '#111',
							areaStyle:{
								color: '#000000'
					 		}
						},
						emphasis: {
							areaColor: '#2a333d'
						}
					},
					data:[
						{name: '103楼', value: Math.round(testio*1000), geoCoord:[772, 243]},
						{name: '104楼', value: Math.round(testio*1000), geoCoord:[813, 136]},
						{name: '106楼', value: Math.round(testio*1000), geoCoord:[847, 64]},
						{name: '109楼', value: Math.round(testio*1000), geoCoord:[106, 326]},
						{name: '112楼', value: 500, geoCoord:[869, 394]},
						{name: '115楼', value: 400, geoCoord:[558, 384]}
					],  
					markPoint : {
						symbol:'pin',
						symbolSize : 5,
						effect : {
						show: true,
						color: '#65c9ff',
							shadowBlur : 1
						},
						data : [
							{name: '103楼', value: 100, geoCoord:[772, 243], itemStyle:{normal:{color:'#65c9ff'}}},
							{name: '104楼', value: 200, geoCoord:[813, 136], itemStyle:{normal:{color:'#65c9ff'}}},
							{name: '106楼', value: 300, geoCoord:[847, 64], itemStyle:{normal:{color:'#65c9ff'}}},
							{name: '109楼', value: 400, geoCoord:[106, 326], itemStyle:{normal:{color:'#65c9ff'}}},
							{name: '112楼', value: 500, geoCoord:[869, 394], itemStyle:{normal:{color:'#65c9ff'}}},
							{name: '115楼', value: 500, geoCoord:[558, 384], itemStyle:{normal:{color:'#65c9ff'}}}
						]
					}
				},
			]
		};//end of var option_sinapsvg


				// 为echarts对象加载数据 
				chart_sinapsvg.setOption(option_sinapsvg); 
				var nowrv0 = 40;
			},
		);
	</script><!-- start of sinapsvg -->

	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/jquery.dropotron.min.js"></script>
	<script src="assets/js/jquery.scrolly.min.js"></script>
	<script src="assets/js/jquery.onvisible.min.js"></script>
	<!-- script src="assets/js/skel.min.js"></script-->
	<script src="assets/js/util.js"></script>
	<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->

	<script src="assets/js/main.js"></script>

</html>